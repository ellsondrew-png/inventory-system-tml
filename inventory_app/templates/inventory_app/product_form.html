{% extends "inventory_app/base.html" %}
{% block title %}Product Form{% endblock %}

{% block content %}
<div class="container">
    <h2 class="mb-4">
        {% if product %}Update Product{% else %}Create Product{% endif %}
    </h2>

    <!-- Add enctype for file uploads -->
    <form method="post" id="productForm" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="form-group">
            <label for="name">Name</label>
            <input type="text" class="form-control" id="name" name="name"
                value="{{ product.name|default_if_none:'' }}" required>
        </div>

        <div class="form-group">
            <label for="designation">Designation</label>
            <input type="text" class="form-control" id="designation" name="designation"
                value="{{ product.designation|default_if_none:'' }}">
        </div>

        <div class="form-group">
            <label for="brand">Brand</label>
            <input type="text" class="form-control" id="brand" name="brand"
                value="{{ product.brand|default_if_none:'' }}" required>
        </div>

        <div class="form-group">
            <label for="barcode">Barcode</label>
            <input type="text" class="form-control" id="barcode" name="barcode"
                value="{{ product.barcode|default_if_none:'' }}" required
                autofocus
                autocomplete="off"
                onkeypress="if(event.key === 'Enter'){document.getElementById('productForm').submit();}">
        </div>

        <div class="form-group">
            <label for="category">Category</label>
            <select class="form-control" id="category" name="category" required>
                {% for category in categories %}
                <option value="{{ category.id }}" {% if product.category.id == category.id %}selected{% endif %}>
                    {{ category.name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="quantity">Quantity</label>
            <input type="number" class="form-control" id="quantity" name="quantity"
                value="{{ product.quantity|default_if_none:0 }}" min="0" required>
        </div>

        <div class="form-group">
            <label for="price">Price</label>
            <input type="number" step="0.01" class="form-control" id="price" name="price"
                value="{{ product.price|default_if_none:'' }}" required>
        </div>

        <!-- New Product Image Field -->
        <div class="form-group">
            <label for="image">Product Image (Optional)</label>
            <input type="file" class="form-control-file" id="image" name="image" accept="image/*">
            {% if product.image %}
                <p>Current image:</p>
                <img src="{{ product.image.url }}" alt="Product Image" style="max-height:150px;">
            {% endif %}
        </div>

        <button type="submit" class="btn btn-primary">Save</button>
        <a href="{% url 'product_list' %}" class="btn btn-secondary">Cancel</a>
    </form>
</div>

<!-- Auto-focus barcode input -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const barcodeInput = document.getElementById('barcode');
        if(barcodeInput) {
            barcodeInput.focus();
        }
    });
</script>

{% endblock %}
